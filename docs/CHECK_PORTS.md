# Проверка портов перед развертыванием

## Команды для проверки занятых портов

```bash
# Показать все слушающие порты
sudo netstat -tlnp | grep LISTEN
# или более современная команда:
sudo ss -tlnp | grep LISTEN

# Проверить конкретный порт
sudo lsof -i :4000
sudo lsof -i :3000
sudo lsof -i :5000
sudo lsof -i :5001

# Или через ss:
sudo ss -tlnp | grep :5000
```

## Как выбрать свободный порт

1. **Проверьте стандартные порты:**
   - 3000 - обычно dev-режим фронтенда (в production не нужен)
   - 4000 - по умолчанию для fit-hub API (может быть занят другими проектами)
   - 4001, 5000, 6000, 8000 - альтернативные варианты

2. **Выберите свободный порт** (например, 4000)

3. **Установите его в трех местах:**
   - `.env` файл: `PORT=4000`
   - `ecosystem.config.js`: `PORT: 4000`
   - `nginx.conf` (или ваш nginx конфиг): `proxy_pass http://localhost:4000`

## Пример вывода команд

```bash
$ sudo ss -tlnp | grep LISTEN

tcp   LISTEN  0  128  0.0.0.0:22    0.0.0.0:*  users:(("sshd",pid=123,fd=3))
tcp   LISTEN  0  128  0.0.0.0:80    0.0.0.0:*  users:(("nginx",pid=456,fd=6))
tcp   LISTEN  0  128  0.0.0.0:443   0.0.0.0:*  users:(("nginx",pid=456,fd=7))
tcp   LISTEN  0  128  127.0.0.1:4000  0.0.0.0:*  users:(("node",pid=789,fd=12))
tcp   LISTEN  0  128  127.0.0.1:5432  0.0.0.0:*  users:(("postgres",pid=101,fd=5))
```

В этом примере:
- ✅ Порт 4000 - свободен (можно использовать, если не занят)
- ❌ Порт 4000 - может быть занят другим node процессом (в примере выше)
- ✅ Порты 3000, 4001, 5000, 6000 - свободны

## Как это работает

1. **Express API сервер** работает на `localhost:4000` (внутренний порт)
2. **Nginx** слушает на порту `80` (публичный HTTP)
3. **Пользователь** заходит на `gymmy-bot.ru` → попадает на Nginx
4. **Nginx** отдает статику или проксирует `/api/*` на `localhost:4000`
5. **Пользователь не видит порт 4000** - все работает через домен

## Быстрая проверка после настройки

```bash
# Проверка, что API сервер запущен на нужном порту
sudo ss -tlnp | grep :4000

# Тест API напрямую (должен работать только с localhost)
curl http://localhost:4000/api/fitness/health

# Тест через Nginx (должен работать с любого места)
curl http://gymmy-bot.ru/api/fitness/health
```

